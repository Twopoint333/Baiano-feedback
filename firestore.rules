
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if a user is signed in (including anonymous users)
    function isSignedIn() {
      return request.auth != null;
    }

    // Rules for the survey_responses collection
    match /survey_responses/{surveyResponseId} {
      // READ: Anyone can read survey responses.
      allow get, list: if true;

      // CREATE: Any signed-in user can submit a new survey response.
      allow create: if isSignedIn();

      // UPDATE & DELETE: No client can modify or delete a survey response.
      allow update, delete: if false;
    }
    
    // Rules for the prize_claims collection
    match /prize_claims/{phoneNumber} {
        // No one can list all prize claims.
        allow list: if false;
        // A user can check if a prize has been claimed for their phone number if they are signed in.
        allow get: if isSignedIn();

        // A user can create a prize claim document only if they are the owner of the claim.
        // The `uid` being written must match the authenticated user's `uid`.
        allow create: if request.auth.uid == request.resource.data.uid;

        // A user can update their own prize claim document.
        // The `uid` in the existing document must match the authenticated user's `uid`.
        allow update: if request.auth.uid == resource.data.uid;
        
        // No one can delete a prize claim.
        allow delete: if false;
    }
  }
}
